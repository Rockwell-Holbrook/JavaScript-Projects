/* -------------- FUNCTIONS BEGIN ------------------*/

/* Sort Function */

function sortByKey(array, key){
return array.sort(function(a,b){
var x = a[key];
var y = b[key];
return ((x<y) ?-1:((x>y)?1:0));
});
}

/* Create my JSON */
function create_json()
{
 var obj = JSON.parse(localStorage.endorsement_JSON);
 var extra = {name: localStorage.name, date: localStorage.date, endorsement:
localStorage.endorsement};
 obj.push(extra);
 localStorage.setItem("endorsement_JSON", JSON.stringify(obj));
}

 /* Save things to localStorage */
function store_name() {
 localStorage.setItem("name", my_name.value);
}
function store_date() {
 localStorage.setItem("date", date.value);
}
function store_endorsement() {
 localStorage.setItem("endorsement", endorsement.value);
}
function store_json() {
 localStorage.setItem("endorsement_JSON", JSON.stringify(my_json));
}

/* Print as the screen loads if there is an existing Json */
window.onload = function first_print(){
var array = JSON.parse(localStorage.endorsement_JSON); // Get an array out of the JSon.
 document.getElementById("please_baby").innerHTML = "";
if(array[0] != undefined){
console.log("onload")
 document.getElementById("please_baby").innerHTML = "";
 for(i = 0; i < array.length; i++) // Print the array.
 {
 document.getElementById("please_baby").innerHTML +=
 array[i].name + "--- " +
 array[i].date + "--- " +
 array[i].endorsement +
 "<br>" + "<br>";
 }
}
}

/* Re-Print the Json on RELOAD */
function print_array(){
 var array = JSON.parse(localStorage.endorsement_JSON); // Get an array out of the JSon.
 document.getElementById("please_baby").innerHTML = "";
 for(i = 0; i < array.length; i++) // Print the array.
 {
 document.getElementById("please_baby").innerHTML +=
 array[i].name + "---" +
 array[i].date + "---" +
 array[i].endorsement +
 "<br>" + "<br>";
 }
}

/* Sort by Date */
function sort_date(){
 var array = JSON.parse(localStorage.endorsement_JSON); // Get an array out of the JSon.
 sortByKey(array, "date");
 document.getElementById("please_baby").innerHTML = "";
 localStorage.setItem("endorsement_JSON", JSON.stringify(array));
 print_array();
}

/* Sort by Name */
function sort_name(){
 var array = JSON.parse(localStorage.endorsement_JSON); // Get an array out of the JSon.
 sortByKey(array, "name");
 document.getElementById("please_baby").innerHTML = "";
 localStorage.setItem("endorsement_JSON", JSON.stringify(array));
 print_array();
}

/* GUP function to parse url for Projects */
function gup( name )
{
 name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
 var regexS = "[\\?&]"+name+"=([^&#]*)";
 var regex = new RegExp( regexS );
 var results = regex.exec( window.location.href );
 if( results == null )
 return "";
 else
 return results[1];
}

/* Get my Local JSON every 5 seconds*/
$(document).ready(function()
{
 setInterval(function(){
$.ajax({
 type: "GET",
 url:"/js/endorsements.json",
 data: "{}",
 dataType: "json",
 cache: false,
 success: function(my_Json) {
 var array = my_Json;
 localStorage.setItem("endorsement_JSON", JSON.stringify(my_Json));
 document.getElementById("please_baby").innerHTML = "";
 
 for(i = 0; i < array.length; i++) // Print the array.
 {
 document.getElementById("please_baby").innerHTML +=
 array[i].name + "---" +
 array[i].date + "---" +
 array[i].endorsement +
 "<br>" + "<br>";
 }
 }
});}, 5000);})

/* -------------- FUNCTIONS END ------------------*/

/* Variables */
var my_array; // This is my array after parsing the Json.
var my_name = document.getElementById("usr");
var date = document.getElementById("pwd");
var endorsement = document.getElementById("endor");

/* Logic: */

/* Create a Json if one doesn't already exist. */
if(localStorage.getItem("endorsement_JSON") == undefined){
 var my_json = []; // This is my Json variable.
 localStorage.setItem("endorsement_JSON", JSON.stringify(my_json));
}

/* Click Handler Calls for buttons */
document.getElementById("submit").addEventListener("click", create_json);
document.getElementById("submit").addEventListener("click", print_array);
document.getElementById("sort_name").addEventListener("click", sort_name);
document.getElementById("sort_date").addEventListener("click", sort_date);

/* Auto Populate */
my_name.value = localStorage.getItem("name");
date.value = localStorage.getItem("date");
endorsement.value = localStorage.getItem("endorsement");
